<!DOCTYPE html>
<html>
<head>
  <title>Sala <%= roomId %></title>
  <script src="/socket.io/socket.io.js"></script>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <h1>Sala: <%= roomId %></h1>
  <ul id="players"></ul>

  <button id="readyBtn">Pronto</button>
  <button id="startBtn" style="display:none;">Iniciar Jogo</button>
  <div id="roleInfo"></div>

  <script>
    const socket = io();
    const roomId = '<%= roomId %>';

    socket.emit('join-room', roomId);

    const playersEl = document.getElementById('players');
    const startBtn = document.getElementById('startBtn');
    const readyBtn = document.getElementById('readyBtn');
    const roleInfo = document.getElementById('roleInfo');

    readyBtn.onclick = () => {
      socket.emit('player-ready', roomId);
      readyBtn.disabled = true;
      readyBtn.innerText = 'Aguardando...';
    };

    startBtn.onclick = () => {
      socket.emit('start-game', roomId);
    };

    socket.on('players-updated', ({ players, ready, allReady }) => {
      playersEl.innerHTML = players.map(p => {
        const isYou = p === socket.id ? ' (vocÃª)' : '';
        const isReady = ready[p] ? 'âœ…' : 'â³';
        return `<li>${p}${isYou} ${isReady}</li>`;
      }).join('');

      if (allReady) {
        startBtn.style.display = 'inline';
      } else {
        startBtn.style.display = 'none';
      }
    });

    socket.on('game-started', () => {
      readyBtn.style.display = 'none';
      startBtn.style.display = 'none';
    });

    socket.on('role-assigned', ({ role, location }) => {
      if (role === 'spy') {
        roleInfo.innerText = 'ğŸ•µï¸ VocÃª Ã© o ESPIÃƒO. Descubra o local!';
      } else {
        roleInfo.innerText = `ğŸ“ Local: ${location} \nğŸ­ Papel: ${role}`;
      }
    });
  </script>
</body>
</html>
